---
title: "Unidad 9 ‚Äî Clasificaci√≥n"
subtitle: "Semana 12: Modelo Logit"
author: "Eduard F. Mart√≠nez Gonz√°lez"
---

<a href="mailto:efmartinez@icesi.edu.co" style="color:black;">
<img src="pic/correo.png" alt="Email" width="20" height="20"/> efmartinez@icesi.edu.co
</a>

<a href="https://github.com/eduard-martinez" style="color:black;"> <img src="pic/github.png" alt="Qries" width="20" height="20"/> eduard-martinez</a>

<a href="https://twitter.com/emartigo" style="color:black;"> <img src="pic/twitter.jpg" alt="Qries" width="20" height="20"/> @emartigo</a>

<a href="https://eduard-martinez.github.io" style="color:black;"> <img src="pic/link.png" alt="Qries" width="20" height="20"/> https://eduard-martinez.github.io</a>

# ¬øQu√© es un problema de clasificaci√≥n?

![](clasfication-gif.gif)

En *Business Analytics*, los modelos de **clasificaci√≥n** se utilizan cuando la **variable de respuesta es categ√≥rica** (por ejemplo, *acepta/no acepta*, *fraude/no fraude*, *compra/no compra*).  
El objetivo es **asignar observaciones a categor√≠as** con base en sus caracter√≠sticas observadas.

**Ejemplos t√≠picos:**

- Determinar si un cliente pagar√° su cr√©dito o caer√° en mora.  
- Identificar si una transacci√≥n es leg√≠tima o fraudulenta.  
- Predecir si un estudiante aprobar√° o no un curso.  
- Clasificar correos en ‚Äúspam‚Äù o ‚Äúno spam‚Äù.

## Limitaciones del modelo lineal cl√°sico

La **regresi√≥n lineal** no es apropiada para variables dicot√≥micas porque:

- Predice valores continuos fuera del rango [0,1].  
- Asume una relaci√≥n lineal entre las variables explicativas y la probabilidad.  
- Viola la homocedasticidad y la normalidad de los errores.

**Soluci√≥n:** usar un modelo que prediga directamente **probabilidades entre 0 y 1**: el **Modelo Logit**.

## El Modelo Logit

El modelo Logit relaciona las variables explicativas con la **probabilidad de √©xito** \( P(Y=1) \) mediante una funci√≥n no lineal llamada **funci√≥n log√≠stica**:

\[ P(Y=1|X) = \frac{1}{1 + e^{-(\beta_0 + \beta_1 X_1 + \cdots + \beta_k X_k)}} \]

Esta transformaci√≥n garantiza que las probabilidades est√©n siempre entre 0 y 1.

**Interpretaci√≥n:**
En lugar de modelar la probabilidad directamente, el Logit modela el **logaritmo de las odds (raz√≥n de probabilidades):**

\[ \log\left(\frac{P(Y=1)}{1 - P(Y=1)}\right) = \beta_0 + \beta_1 X_1 + \cdots + \beta_k X_k \]

Cada coeficiente \(\beta_j\) indica c√≥mo cambia el **log-odds** de √©xito cuando \(X_j\) aumenta en una unidad.

## Odds y log-odds: intuici√≥n pr√°ctica

- **Odds (raz√≥n de probabilidades):**
  \[
  \text{odds} = \frac{P(Y=1)}{1 - P(Y=1)}
  \]
  Ejemplo: si \(P=0.8\), las odds son 4 a 1.

- **Log-odds:** logaritmo natural de las odds.  
  El modelo Logit asume que estas log-odds var√≠an linealmente con las variables explicativas.

::: callout-note
**Nota:**  
Las *odds* comparan la probabilidad de √©xito frente a la de fracaso.  
El logaritmo convierte esta raz√≥n en una escala continua, lo que permite aplicar un modelo lineal.
:::

## Interpretaci√≥n de los coeficientes

Cada par√°metro \(\beta_j\) se interpreta como el cambio en el log-odds de √©xito por un aumento unitario en \(X_j\).

- Si \( \beta_j > 0 \): \(X_j\) aumenta la probabilidad de √©xito.  
- Si \( \beta_j < 0 \): \(X_j\) reduce la probabilidad de √©xito.

Para una interpretaci√≥n m√°s intuitiva se usa el **odds ratio (e^{\beta_j})**, que indica **cu√°nto se multiplican las odds** al aumentar \(X_j\) en una unidad.

::: callout-tip
**Ejemplo interpretativo:**  
Si \(e^{\beta_1} = 1.5\), un aumento de una unidad en \(X_1\) incrementa las probabilidades de √©xito en un **50 %**.
:::

## Evaluaci√≥n del modelo

Las m√©tricas m√°s comunes para evaluar modelos de clasificaci√≥n incluyen:

| M√©trica | Descripci√≥n |
|----------|--------------|
| **Exactitud (Accuracy)** | Proporci√≥n de predicciones correctas sobre el total. |
| **Sensibilidad (Recall)** | Capacidad del modelo para identificar correctamente los casos positivos. |
| **Especificidad** | Capacidad del modelo para identificar correctamente los casos negativos. |
| **Precisi√≥n (Precision)** | Proporci√≥n de verdaderos positivos entre todos los positivos predichos. |
| **F1-Score** | Media arm√≥nica entre precisi√≥n y sensibilidad. |
| **AUC-ROC** | Eval√∫a la capacidad del modelo para distinguir entre clases. |

::: callout-note
**Matriz de confusi√≥n:**  
Muestra c√≥mo el modelo clasifica los casos reales en comparaci√≥n con los predichos.  
Permite calcular todas las m√©tricas anteriores.
:::

## Aplicaciones en Business Analytics

- **Banca y microfinanzas:** modelos de *credit scoring* (probabilidad de incumplimiento).  
- **Marketing:** predicci√≥n de cancelaciones o *churn*.  
- **Salud:** diagn√≥stico temprano (presencia o ausencia de enfermedad).  
- **Recursos Humanos:** predicci√≥n de rotaci√≥n laboral o desempe√±o.

**Idea clave:**  

El modelo Logit permite traducir caracter√≠sticas observables en **probabilidades de ocurrencia de un evento**,  
facilitando la **toma de decisiones basada en riesgo**.

::: callout-tip
**Resumen:**  
El modelo Logit es el punto de partida de la anal√≠tica predictiva moderna. Permite estimar probabilidades y clasificar observaciones en grupos, combinando interpretabilidad y rigor estad√≠stico.
:::

---

# Aplicaci√≥n en R

Para ilustrar el uso de los **modelos de clasificaci√≥n**, trabajaremos con una base sint√©tica que representa a **estudiantes inscritos en un curso universitario**. Cada registro contiene informaci√≥n sobre el comportamiento acad√©mico y el desempe√±o del estudiante a lo largo del semestre, lo que nos permitir√° **estimar la probabilidad de aprobar el curso** y analizar los factores que m√°s influyen en ese resultado.

En este contexto:

- Cada **observaci√≥n** corresponde a un estudiante.  
- La **variable dependiente** es binaria: `aprueba` (1 = aprueba, 0 = reprueba).  
- Las **variables explicativas** describen aspectos como el n√∫mero de horas de estudio, la asistencia, la participaci√≥n y la afinidad con la estad√≠stica.  

El objetivo es construir un **modelo Logit** que nos permita responder preguntas como:

- ¬øQu√© factores aumentan la probabilidad de aprobar el curso?  
- ¬øC√≥mo se interpreta el efecto de cada variable en t√©rminos de *odds ratio*?  
- ¬øQu√© tan bien puede el modelo predecir los resultados acad√©micos?  

Este tipo de an√°lisis es una herramienta clave en **Business Analytics**, ya que permite tomar decisiones basadas en datos ‚Äîpor ejemplo, identificar estudiantes en riesgo acad√©mico, dise√±ar estrategias de acompa√±amiento o evaluar la efectividad de las metodolog√≠as de ense√±anza.

::: callout-tip
üí° **C√≥mo usar este material:**  
Puedes ejecutar los _chunks_ de R directamente en el navegador gracias a **webR**, sin necesidad de instalar nada localmente.
:::

## Preparaci√≥n del entorno

El prop√≥sito de este bloque es asegurar un entorno **limpio, reproducible y funcional** antes de iniciar el an√°lisis.  
Primero, eliminamos cualquier objeto previo que pueda interferir con la sesi√≥n actual. Luego, instalamos (si es necesario) y cargamos los paquetes requeridos para la **manipulaci√≥n de datos**, la **visualizaci√≥n** y la **estimaci√≥n del modelo Logit**.  

Con esto, dejamos el entorno preparado para comenzar el an√°lisis aplicado.

```{webr-r}
## Limpiar el entorno de trabajo
rm(list = ls())

## Instalar paquetes (solo si es necesario)
install.packages("tidyverse")
install.packages("broom")
install.packages("pROC") 


## Cargar librer√≠as
library(tidyverse)  # Manipulaci√≥n y visualizaci√≥n de datos
library(broom)      # Para resumir resultados de modelos
library(pROC)       # Calcular la curva ROC y el AUC
 
## Fijar semilla para reproducibilidad
set.seed(123)
```

::: callout-note
Los paquetes `tidyverse` y `broom` son parte del ecosistema de an√°lisis de datos en R:
	‚Ä¢	`tidyverse` permite transformar y visualizar datos de manera eficiente.
	‚Ä¢	`broom` facilita la conversi√≥n de resultados de modelos estad√≠sticos en tablas ordenadas y listas para interpretar.
:::

## Ingesta de datos 

En esta secci√≥n realizamos la ingesta de datos, es decir, el proceso de generar o cargar la base que utilizaremos para estimar el modelo Logit. Cada registro representa a un estudiante, con variables relacionadas con su esfuerzo, participaci√≥n y rendimiento a lo largo del semestre.

La estructura de los datos es la siguiente:
	‚Ä¢	horas_estudio: promedio semanal de horas dedicadas al curso.
	‚Ä¢	asistencia: porcentaje de asistencia a clase.
	‚Ä¢	participacion: nivel de participaci√≥n en clase (0‚Äì100).
	‚Ä¢	uso_de_R: nivel de dominio de R (1‚Äì5).
	‚Ä¢	trabajos_entregados: cantidad de trabajos entregados (0‚Äì5).
	‚Ä¢	afinidad_estadistica: gusto por la estad√≠stica (0‚Äì100).
	‚Ä¢	aprueba: resultado final (1 = aprueba, 0 = reprueba).
	‚Ä¢	retira: indica si el estudiante se retir√≥ del curso antes de finalizar (1 = s√≠, 0 = no).

Nuestro objetivo ser√° estimar c√≥mo cada una de estas variables influye en la probabilidad de aprobar el curso.

```{webr-r}
#| warning: false
#| message: false

## generar los datos
source("https://raw.githubusercontent.com/ba-in-r/01-slides/main/week-13/data/week-13.r")

## chuequear objeto
head(datos)
```

## Estimaci√≥n del Modelo Logit

En esta secci√≥n estimaremos un **modelo Logit** para predecir la probabilidad de que un estudiante **apruebe el curso**, utilizando las variables explicativas incluidas en la base de datos.

El objetivo es cuantificar c√≥mo influyen factores como las horas de estudio, la asistencia, la participaci√≥n en clase o la afinidad con la estad√≠stica sobre la probabilidad de aprobar.

### Formulaci√≥n del modelo

El modelo Logit se puede expresar como:

$\log\left(\frac{P(\text{aprueba}=1)}{1 - P(\text{aprueba}=1)}\right) =$

$f(\text{horas\_estudio},\text{asistencia},\text{participacion},\text{uso\_de\_R},\text{trabajos\_entregados},\text{afinidad\_estadistica})$

Donde:

- El t√©rmino del lado izquierdo representa el **logaritmo de las odds** de aprobar.  
- Los coeficientes \(\beta_j\) indican c√≥mo cambia el log-odds de aprobar ante un cambio unitario en cada variable.

### Estimaci√≥n en R

Usaremos la funci√≥n `glm()` (Generalized Linear Model) especificando `family = binomial(link = "logit")` para estimar el modelo log√≠stico.

```{webr-r}
# Estimar el modelo logit
modelo_logit <- glm(aprueba ~ horas_estudio + asistencia + participacion + 
                      uso_de_R + trabajos_entregados + afinidad_estadistica,
                    data = datos,
                    family = binomial(link = "logit"))

# Resumen general
summary(modelo_logit)
```

::: callout-note
**Interpretaci√≥n inicial:** Un coeficiente positivo indica que un aumento en la variable incrementa la probabilidad de aprobar, mientras que un coeficiente negativo la reduce. Sin embargo, los valores de los coeficientes est√°n en escala log-odds, por lo que deben transformarse para interpretarse como odds ratios.
:::

### Interpretaci√≥n de coeficientes

Para obtener una interpretaci√≥n m√°s intuitiva, transformamos los coeficientes mediante la exponenciaci√≥n:

\text{odds ratio} = e^{\beta_j} 

Un odds ratio mayor a 1 indica que un aumento en la variable incrementa la probabilidad de aprobar, mientras que un valor menor a 1 indica que la reduce.

```{webr-r}
# 1. Extraemos los resultados del modelo en formato ordenado usando broom::tidy()
r_logit_1 <- tidy(modelo_logit)
head(r_logit_1)
```

```{webr-r}
# 2. Creamos una nueva columna 'odds_ratio' aplicando la funci√≥n exponencial a los coeficientes
#    Esto convierte los coeficientes en t√©rminos de cambio multiplicativo en las odds
r_logit_2 <- mutate(r_logit_1, odds_ratio = exp(estimate))
head(r_logit_2)
```

```{webr-r}
# 3. Seleccionamos √∫nicamente las columnas de inter√©s:
#    - term: nombre de la variable
#    - estimate: coeficiente estimado (log-odds)
#    - odds_ratio: raz√≥n de probabilidades
#    - p.value: nivel de significancia estad√≠stica
r_logit_3 <- select(r_logit_2, term, estimate, odds_ratio, p.value)

# 4. Mostramos la tabla final con resultados listos para interpretaci√≥n
r_logit_3
```

::: callout-tip
**Ejemplo de interpretaci√≥n:** Si el odds ratio de horas_estudio es 1.27, significa que por cada hora adicional de estudio, las probabilidades de aprobar el curso se incrementan en un 27%, manteniendo las dem√°s variables constantes.
:::

## Evaluaci√≥n del Modelo Logit

Una vez estimado el modelo Logit, necesitamos **evaluar su capacidad predictiva**:¬øqu√© tan bien logra distinguir entre los estudiantes que aprueban y los que no? 

En esta secci√≥n construiremos una **matriz de confusi√≥n**, calcularemos **m√©tricas de desempe√±o** y visualizaremos la **curva ROC** (*Receiver Operating Characteristic*) para medir el poder discriminatorio del modelo.

### Predicciones del modelo

Usamos la funci√≥n `predict()` para calcular la **probabilidad estimada de aprobar** (`prob_predicha`) y clasificamos a cada estudiante seg√∫n un umbral de 0.5 (es decir, si la probabilidad es mayor a 0.5, se predice que aprueba).

```{webr-r}
# Generar predicciones
datos <- mutate(datos,
                prob_predicha = predict(modelo_logit, type = "response"),
                aprueba_pred = if_else(prob_predicha > 0.5, 1, 0))

# Verificar las primeras observaciones
head(select(datos, aprueba, prob_predicha, aprueba_pred))
```

::: callout-note
**Nota:** El valor 0.5 es un umbral arbitrario.
Podemos ajustarlo seg√∫n los objetivos del an√°lisis:
	‚Ä¢	Usar un umbral menor (p. ej. 0.4) si queremos detectar m√°s estudiantes en riesgo (aunque aumenten los falsos positivos).
	‚Ä¢	Usar un umbral mayor (p. ej. 0.6) si preferimos mayor precisi√≥n en las predicciones positivas.
:::

### Matriz de confusi√≥n

La matriz de confusi√≥n compara las predicciones del modelo con los valores reales y permite visualizar los aciertos y errores de clasificaci√≥n.

```{webr-r}
# Matriz de confusi√≥n
table(Prediccion = datos$aprueba_pred, Real = datos$aprueba)
```

Interpretaci√≥n de los resultados:

	‚Ä¢	Verdaderos positivos (VP): el modelo predice aprobar y el estudiante aprueba.
	‚Ä¢	Verdaderos negativos (VN): el modelo predice reprobar y el estudiante reprueba.
	‚Ä¢	Falsos positivos (FP): el modelo predice aprobar pero el estudiante reprueba.
	‚Ä¢	Falsos negativos (FN): el modelo predice reprobar pero el estudiante aprueba.

### M√©tricas de desempe√±o

A partir de la matriz de confusi√≥n calculamos las m√©tricas m√°s comunes para evaluar un modelo de clasificaci√≥n:

$\text{Accuracy} = \frac{VP + VN}{VP + VN + FP + FN}$

$\text{Sensibilidad (Recall)} = \frac{VP}{VP + FN}$

$\text{Especificidad} = \frac{VN}{VN + FP}$

$\text{Precisi√≥n (Precision)} = \frac{VP}{VP + FP}$



```{webr-r}
## Calcular m√©tricas de desempe√±o
VP <- sum(datos$aprueba_pred == 1 & datos$aprueba == 1)
VN <- sum(datos$aprueba_pred == 0 & datos$aprueba == 0)
FP <- sum(datos$aprueba_pred == 1 & datos$aprueba == 0)
FN <- sum(datos$aprueba_pred == 0 & datos$aprueba == 1)

## Metricas
accuracy <- (VP + VN) / (VP + VN + FP + FN)
sensibilidad <- VP / (VP + FN)
especificidad <- VN / (VN + FP)
precision <- VP / (VP + FP)

## Metricas del modelo
tibble(accuracy = round(accuracy, 3),
sensibilidad = round(sensibilidad, 3),
especificidad = round(especificidad, 3),
precision = round(precision, 3))
```

::: callout-tip
üí° Interpretaci√≥n pr√°ctica:
	‚Ä¢	Exactitud (Accuracy): proporci√≥n de predicciones correctas.
	‚Ä¢	Sensibilidad: qu√© tan bien el modelo identifica a quienes aprueban.
	‚Ä¢	Especificidad: qu√© tan bien identifica a quienes reprueban.
	‚Ä¢	Precisi√≥n: de los que el modelo predice como aprobados, cu√°ntos realmente aprueban.
:::


### Curva ROC y AUC

La curva ROC muestra la relaci√≥n entre la tasa de verdaderos positivos (sensibilidad) y la tasa de falsos positivos (1 - especificidad) para distintos umbrales de decisi√≥n.

El √Årea Bajo la Curva (AUC) mide el desempe√±o general del modelo:

	‚Ä¢	AUC = 0.5 ‚Üí el modelo no discrimina (como lanzar una moneda).
	‚Ä¢	AUC = 1 ‚Üí el modelo clasifica perfectamente.

```{webr-r}
# Calcular la curva ROC y el AUC
roc_obj <- roc(datos$aprueba, datos$prob_predicha)

# Mostrar AUC
auc(roc_obj)

# Graficar la curva ROC
plot(roc_obj, col = "blue", lwd = 2, main = "Curva ROC ‚Äî Modelo Logit")
abline(a = 0, b = 1, lty = 2, col = "gray")
```

::: callout-note
Un valor de AUC entre 0.7 y 0.9 indica un buen poder discriminatorio, mientras que valores superiores a 0.9 suelen considerarse excelentes. Si el AUC est√° cerca de 0.5, el modelo no est√° capturando patrones √∫tiles.
:::

### Visualizaci√≥n de resultados

Finalmente, podemos representar la relaci√≥n entre la probabilidad predicha de aprobar y alguna variable explicativa, como las horas de estudio.

```{webr-r}
geom_point(alpha = 0.4, color = "steelblue") +
geom_smooth(method = "loess", se = FALSE, color = "black") +
labs(title = "Probabilidad predicha de aprobar seg√∫n horas de estudio",
     x = "Horas de estudio por semana",
     y = "Probabilidad estimada de aprobar") +
theme_minimal()
```
  
::: callout-tip
**Interpretaci√≥n visual:**
La curva creciente refleja la naturaleza no lineal del modelo Logit. A medida que aumentan las horas de estudio, la probabilidad de aprobar se incrementa, pero a un ritmo decreciente: los beneficios marginales de estudiar m√°s disminuyen.
:::

# Actividad en Clase

## Instrucciones:

1. Ejecute los *chunks* de c√≥digo proporcionados en R (puede hacerlo directamente en el navegador o en RStudio).  
2. Observe los resultados obtenidos en cada secci√≥n.  
3. Genere un documento en **Word (.docx)** donde:  
   - Copie las preguntas que aparecen al final.  
   - Redacte sus interpretaciones y conclusiones con base en los resultados.  
   - **No copie el c√≥digo ni las tablas**, solo redacte sus respuestas.  
4. Suba su documento a la plataforma **Intu**, en la actividad correspondiente a la **Semana 13 ‚Äî Modelo Logit (Predicci√≥n de Retiro)**.

### Estimaci√≥n del modelo Logit

Ejecute el siguiente c√≥digo para estimar un modelo Logit que prediga la **probabilidad de que un estudiante se retire del curso**, usando las variables explicativas relacionadas con esfuerzo y participaci√≥n.  
‚ö†Ô∏è No incluya la variable `aprueba` en el modelo.

```{webr-r}
# Estimar el modelo logit
modelo_logit <- glm(retira ~ horas_estudio + asistencia + participacion + 
                    uso_de_R + trabajos_entregados + afinidad_estadistica,
                    data = datos,
                    family = binomial(link = "logit"))

# Resumen general
summary(modelo_logit)
```

### Evaluaci√≥n del Modelo Logit

Una vez estimado el modelo, eval√∫e su capacidad predictiva. A partir de los resultados, analice qu√© tan bien el modelo distingue entre los estudiantes que se retiran y los que no.

  + Predicciones del modelo: Genere las probabilidades predichas y clasifique a cada estudiante seg√∫n un umbral de 0.5.
  + Genere la matriz de confusi√≥n para comparar las predicciones con los valores reales.
  + Calcule las m√©tricas b√°sicas del modelo: exactitud, sensibilidad, especificidad y precisi√≥n.
  + Calcule el √Årea Bajo la Curva (AUC) para medir el poder discriminatorio del modelo.
  + Visualice la relaci√≥n entre la probabilidad predicha de retiro y una variable explicativa (por ejemplo, las horas de estudio).

## Preguntas para el informe

1. Interpretaci√≥n general
	‚Ä¢	¬øQu√© variables parecen tener mayor influencia en la probabilidad de retiro seg√∫n el resumen del modelo (summary(modelo_logit))?
	‚Ä¢	¬øCu√°l es el signo del coeficiente asociado a horas_estudio y c√≥mo lo interpretar√≠as?
	‚Ä¢	¬øQu√© significa que una variable tenga un p-valor alto (mayor a 0.05)?

2. Evaluaci√≥n del desempe√±o
	‚Ä¢	¬øQu√© tan bien clasifica el modelo seg√∫n las m√©tricas de desempe√±o calculadas?
	‚Ä¢	Si la exactitud (accuracy) es del 75 %, ¬øc√≥mo interpretar√≠as este resultado en un contexto acad√©mico?
	‚Ä¢	¬øEl modelo tiende a cometer m√°s falsos positivos o falsos negativos? ¬øQu√© implicaciones tendr√≠a eso?

3. Curva ROC y visualizaci√≥n
	‚Ä¢	¬øQu√© valor obtuvo el AUC y qu√© indica sobre el poder predictivo del modelo?
	‚Ä¢	¬øC√≥mo se interpreta la relaci√≥n entre las horas de estudio y la probabilidad de retiro en el gr√°fico final?
	‚Ä¢	¬øQu√© estrategias institucionales podr√≠an derivarse de estos resultados?

::: callout-tip
üí° Entrega: Suba su documento con las respuestas a la plataforma Intu, en la actividad correspondiente a la Semana 13 ‚Äî Modelo Logit. Y suba el script con el que realizo el proedimiento. Recuerde que se evaluar√° la claridad de sus interpretaciones, la consistencia con los resultados del modelo y su capacidad para proponer acciones basadas en los hallazgos.
:::






